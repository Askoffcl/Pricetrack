{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />


    
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<link rel="stylesheet" href="{% static 'products/viewComplaint.css' %}">
    {% block extra_head %} {% endblock %}
  </head>

  <body>



    <header class="navbar">
      <p class="leftnav"><a href="/">Price Track</a></p>
      <div class="rightnav">
        
        
        {% if request.user.role == 'admin' %}
        <a href="/homepage">Home</a>
        <a href="/about">About</a>
        <a href="/logout">Logout</a>
        {% elif request.user.role == 'User' %}
        <a href="/homepage">Home</a>
        <a href="#">About</a>
        <a href="/logout">Logout</a>
        {% elif request.user.role == 'retailer' %}
        <a href="/homepage">Home</a>
        <a href="/about">About</a>
        <a href="/logout">Logout</a>
        
        {% else %}
        <a href="/about">About</a>
        <a href="/userregistration">Register</a>
        <a href="/shopregister">Register as Organizer</a>
        <a href="/login">Login</a>
        {% endif %} 
        
        {% if search == 1 %}
        <form method="get" class="search" action="{% url 'productsearch' %}">
          <input type="text" name="search" placeholder="Search products..." />
          <button type="submit">Search</button>
        </form>
        {% endif %}
        {% if search == 2 %}
        <form method="get" class="search" action="{% url 'shopSearch' %}">
          <input type="text" name="search" placeholder="Search products..." />
          <button type="submit">Search</button>
        </form>
        {% endif %}
      
      </div>
    </header>
  
    {% if messages %}
    <div id="toast-container">
        {% for message in messages %}
            <div class="toast alert alert-{{ message.tags }} text-{{message.tags}}">{{ message }}</div>
        {% endfor %}
    </div>
{% endif %}
     
    {% block content %} {% endblock %}
    
        
        {% if request.user.role == 'admin' %}
      
        {% elif request.user.role == 'User' %}
   
        {% elif request.user.role == 'retailer' %}
    
        {% else %}
    
         <footer class="footer">
  <p>&copy; 2025 PriceCompare. All rights reserved.</p>
</footer>
        {% endif %}
   
  </body>
 
<script>
    // Automatically fade out toast messages after 3 seconds
    document.addEventListener('DOMContentLoaded', function () {
        const toasts = document.querySelectorAll('.toast');
        toasts.forEach(toast => {
            setTimeout(() => {
                toast.style.transition = 'opacity 0.5s ease';
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 1000); // Remove the element after fade-out
            }, 3000);
        });
});
</script>
</html>




<div class="full">
  <div class="side">
    <a href="/product/orderplaced"><button>Order Placed</button></a>


      {% if request.user.role == 'User' %}
                   <a href="/product/viewshopProduct"><button>Products</button></a>
                    <a href="/product/viewCart"><button>View Cart</button></a>
                   {% endif %}
    {% if request.user.role == 'retailer' %}
    <a href="/product/viewproducts"><button>Add Products</button></a>
     <a href="/product/viewshopProduct"><button>My Products</button></a>
    <a href="/product/viewFeedback"><button>View Feedback</button></a>
    <a href="/product/viewallreq"><button>My Request</button></a>

    {% endif %} 
    {% if request.user.is_superuser %}
      <a href="/product/viewshopProduct"><button>Products</button></a>
    <a href="/product/category"><button>Category</button></a>
    <a href="/product/viewproducts"><button>Admin Products</button></a>
    <a href="/product/addproducts"><button>Add Products</button></a>
    <a href="/product/viewComplaint"><button>Complaints</button></a>
    <a href="/product/notavailable"><button>Request</button></a>
    <a href="/product/viewShopowner"><button>View Shopowners</button></a>
    <a href="/product/viewShopuser"><button>View ShopUsers</button></a>
    <a href="/product/requestHistory"><button>Request History</button></a>

    {% endif %} 
    {% if not request.user.is_superuser %}

 
    <a href="{% url 'complaint' user.id %}"><button>Any complaints</button></a>
    <a href="/product/complaintStatus"><button>Complaint status</button></a>
    {% endif %}
  </div>
</div>
    <table>
      <tr>
          <th>No</th>
        <th>Message</th>
        <th>User</th>
        <th>Date</th>
        <th>Status</th>
        <th>Update</th>
      </tr>
      {% for fed in complaint %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ fed.description }}</td>
        <td>{{ fed.userid.username }}</td>
         <td>{{ fed.orderdate }}</td>
        <td>{{ fed.status }}</td>
        <td>
         <form id="form-{{ fed.id }}" method="post" action="{% url 'updateStatus' fed.id %}">

            <div class="customall">
            {% csrf_token %}
        
            <input type="hidden" name="status" id="status-{{ fed.id }}">
<input type="hidden" name="reason" id="reason-{{ fed.id }}">
            <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#reasonModal" data-form="{{ fed.id }}">
           Update
            </button>
            </div>
          </form>
       
        </td>
      </tr>
       {% empty %}
      <tr>
        <td colspan="5">No requests found.</td>
      </tr>
      {% endfor %}
    </table>
    <div class="modal fade" id="reasonModal" tabindex="-1" aria-labelledby="reasonModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reason </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
             <select id="modal-status" class="form-select mb-3">
              <option value="pending" {% if fed.status == "pending" %}selected{% endif %}>Pending</option>
              <option value="working on" {% if fed.status == "working on" %}selected{% endif %}>Working on</option>
              <option value="resolved" {% if fed.status == "resolved" %}selected{% endif %}>Resolved</option>
            </select>
        <textarea id="modal-reason" class="form-control" placeholder="Enter reason" name="modal-reason"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" id="submit-reason-btn" class="btn btn-success">Submit</button>
      </div>
    </div>
  </div>
</div>

<script>
  let currentForm = null;
  document.getElementById('reasonModal').addEventListener('show.bs.modal',function(event)
{
  const button = event.relatedTarget;
  const formid = button.getAttribute('data-form');
  currentForm = document.getElementById('form-' + formid);
});

  document.getElementById('submit-reason-btn').addEventListener('click', function () {
    const reason = document.getElementById('modal-reason').value.trim();
    const status = document.getElementById('modal-status').value;
    if (!reason) {
      alert('Please enter a reason.');
      return;
    }
    currentForm.querySelector('[name="reason"]').value = reason;
        currentForm.querySelector('[name="status"]').value = status;
    currentForm.submit();
  });
</script>

